<div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in">
    <div
        class="bg-white rounded-lg shadow-xl w-full max-w-lg overflow-hidden transform transition-all scale-100 max-h-[90vh] overflow-y-auto">
        <!-- Header -->
        <div class="bg-purple-600 px-6 py-4 flex items-center justify-between">
            <h3 id="modal-title" class="text-lg font-bold text-white flex items-center gap-2">
                <span class="material-symbols-outlined">event_note</span> 새 일정 등록
            </h3>
            <button id="btn-modal-close" class="text-white hover:text-purple-200 transition">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <!-- Form -->
        <form id="schedule-form" class="p-6 space-y-4">
            <input type="hidden" id="schedule-id">

            <!-- Title -->
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">일정명</label>
                <input type="text" id="sched-title" required
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-purple-500 outline-none"
                    placeholder="예: 직원 회의">
            </div>

            <!-- Date Range -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">시작일</label>
                    <input type="date" id="sched-start" min="2000-01-01" max="2100-12-31" required
                        class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">종료일</label>
                    <input type="date" id="sched-end" min="2000-01-01" max="2100-12-31" required
                        class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-purple-500">
                </div>
            </div>
            
            <!-- Include Holidays Option -->
            <div id="include-holidays-wrapper" class="px-1">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="sched-include-holidays"
                        class="rounded text-orange-600 focus:ring-orange-500">
                    <span class="text-sm text-gray-700 font-bold">휴일 포함</span>
                    <span class="text-xs text-gray-400 font-normal">(체크 시 주말·공휴일 포함)</span>
                </label>
            </div>

            <!-- Department -->
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">담당 부서</label>
                <select id="sched-dept"
                    class="w-full border rounded px-3 py-2 bg-white focus:ring-2 focus:ring-purple-500">
                    <!-- Populated by JS -->
                </select>
            </div>

            <!-- Recurrence (New) -->
            <div id="recurrence-section" class="bg-blue-50 p-3 rounded border border-blue-100">
                <label class="flex items-center gap-2 cursor-pointer mb-2">
                    <input type="checkbox" id="sched-repeat" class="rounded text-blue-600 focus:ring-blue-500">
                    <span class="text-sm font-bold text-blue-800">🔁 반복 설정</span>
                </label>

                <div id="recurrence-options" class="hidden space-y-3 mt-2 pl-6 border-l-2 border-blue-200">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">반복 주기</label>
                        <select id="sched-freq" class="w-full text-sm border rounded px-2 py-1">
                            <option value="weekly">매주 (Weekly)</option>
                            <option value="biweekly">격주 (Every 2 weeks)</option>
                            <option value="monthly">매월 (Monthly - 같은 날짜)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">반복 종료일</label>
                        <input type="date" id="sched-until" min="2000-01-01" max="2100-12-31" class="w-full text-sm border rounded px-2 py-1">
                    </div>
                    <p class="text-xs text-blue-600">⚠️ 저장 시 개별 일정이 생성됩니다.</p>
                </div>
            </div>

            <!-- Visibility -->
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">공개 설정</label>
                <select id="sched-visibility"
                    class="w-full border rounded px-3 py-2 bg-white focus:ring-2 focus:ring-purple-500">
                    <option value="public">전체 공개 (홈페이지 게시)</option>
                    <option value="internal" selected>교직원 내부용</option>
                    <option value="dept">우리 부서만 보기</option>
                </select>
                <p id="visibility-hint" class="text-xs text-gray-500 mt-1 pl-1"></p>
            </div>

            <!-- Description -->
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">상세 내용</label>
                <textarea id="sched-desc" rows="3"
                    class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-purple-500"
                    placeholder="장소, 준비물 등 메모"></textarea>
            </div>

            <!-- Options -->
            <div class="flex items-center gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="sched-printable" checked
                        class="rounded text-purple-600 focus:ring-purple-500">
                    <span class="text-sm text-gray-700">인쇄 시 포함</span>
                </label>
            </div>

            <!-- Footer Buttons -->
            <div class="flex justify-between items-center pt-4 border-top">
                <button type="button" id="btn-delete"
                    class="text-red-500 hover:bg-red-50 px-3 py-2 rounded font-medium transition hidden">
                    <span class="material-symbols-outlined align-middle">delete</span> 삭제
                </button>
                <div class="flex gap-2 ml-auto">
                    <button type="button" id="btn-cancel"
                        class="text-gray-600 hover:bg-gray-100 px-4 py-2 rounded font-medium transition">취소</button>
                    <button type="submit" id="btn-save"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded font-bold shadow transition">저장</button>
                </div>
            </div>
        </form>
    </div>
</div>